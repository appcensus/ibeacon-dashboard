function loadData(){var a=$.Deferred(),b=Parse.Object.extend("Event"),c=new Parse.Query(b);return c.lessThanOrEqualTo("exitTime",new Date(moment().format())),c.greaterThanOrEqualTo("enterTime",new Date(moment().subtract(PERIOD-1,"days").startOf("day").format())),c.find({success:function(b){a.resolve(b)},error:function(b){alert("Error: "+b.code+" "+b.message),a.resolve()}}),a}function organizeData(){for(var a=_.groupBy(events,function(a){return moment(a.get("enterTime")).format("YYYY-M-D")}),b=0;PERIOD>b;b++){var c=moment().subtract(b,"days").format("YYYY-M-D");if(x.push(c),a.hasOwnProperty(c)){var d=0;_.each(a[c],function(a){var b=moment(a.get("enterTime")),c=a.get("exitTime")?a.get("exitTime"):moment(),e=moment(c);d+=e.diff(b,"minutes")}),minutes.push(d)}else minutes.push(0)}}function update(){x=x.slice(0,1),minutes=minutes.slice(0,1);var a=$("#spinner");a.show(),loadData().done(function(b){events=null,events=b,organizeData(),a.hide(),chart.load({columns:[x,minutes]})})}var appId="8ZRnPK6TTi8p9uGrARtm0RvF1eAKgzciL18oASuF",key="bhXp8UST70ApUILSCvE2llMLTh5RBVRgP2K6Jl4a",x=["x"],minutes=["Minutes"],PERIOD=1,events=[],chart;$(function(){Parse.initialize(appId,key),$("#period").on("change",function(){var a=$(this).val();PERIOD!==a&&(PERIOD=a,update())}),loadData().done(function(a){events=a,organizeData(),$("#spinner").hide(),$("#main").show(),chart=c3.generate({data:{x:"x",type:"bar",columns:[x,minutes]},axis:{x:{type:"timeseries",tick:{format:"%Y-%m-%d"}}}})})});