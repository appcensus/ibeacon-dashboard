function loadData(){var a=$.Deferred(),b=Parse.Object.extend("Event"),c=new Parse.Query(b);return console.log(new Date(moment().format())),c.lessThanOrEqualTo("exitTime",new Date(moment().format())),c.greaterThanOrEqualTo("enterTime",new Date(moment().subtract(PERIOD-1,"days").startOf("day").format())),c.find({success:function(b){a.resolve(b)},error:function(b){alert("Error: "+b.code+" "+b.message),a.resolve()}}),a}function organizeData(){var a=_.groupBy(events,function(a){return moment(a.attributes.enterTime).format("YYYY-M-D")});x=x.concat(_.keys(a)),_.each(a,function(a){var b=0;_.each(a,function(a){var c=moment(a.attributes.enterTime),d=a.attributes.exitTime?a.attributes.exitTime:moment(),e=moment(d);b+=e.diff(c,"minutes")}),minutes.push(b)})}function update(){x=x.slice(0,1),minutes=minutes.slice(0,1);var a=$("#loading-spinner");a.show(),loadData().done(function(b){events=null,events=b,organizeData(),a.hide(),chart.load({columns:[x,minutes]})})}var appId="8ZRnPK6TTi8p9uGrARtm0RvF1eAKgzciL18oASuF",key="bhXp8UST70ApUILSCvE2llMLTh5RBVRgP2K6Jl4a",x=["x"],minutes=["Minutes"],PERIOD=1,events=[],chart;$(function(){Parse.initialize(appId,key),$("#period").on("change",function(){var a=$(this).val();PERIOD!==a&&(PERIOD=a,update())}),loadData().done(function(a){events=a,organizeData(),$(".loading-spinner").hide(),$(".main").show(),chart=c3.generate({data:{x:"x",type:"bar",columns:[x,minutes]},axis:{x:{type:"timeseries",tick:{format:"%Y-%m-%d"}}}})})});